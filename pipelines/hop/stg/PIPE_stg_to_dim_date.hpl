<?xml version="1.0" encoding="UTF-8"?>
<pipeline>
  <info>
    <name>PIPE_stg_to_dim_date</name>
    <name_sync_with_filename>Y</name_sync_with_filename>
    <description/>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <parameters>
    </parameters>
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    <created_user>-</created_user>
    <created_date>2025/10/16 11:37:27.039</created_date>
    <modified_user>-</modified_user>
    <modified_date>2025/10/16 11:37:27.039</modified_date>
  </info>
  <notepads>
  </notepads>
  <order>
    <hop>
      <from>01_LerDadosRawBD</from>
      <to>02_UnpivotData</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>02_UnpivotData</from>
      <to>03_AjustarFusoHorario</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>03_AjustarFusoHorario</from>
      <to>04_FormatarData</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>03_AjustarFusoHorario</from>
      <to>Dummy (valores atípicos)</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>04_FormatarData</from>
      <to>05_ValidarData</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>05_ValidarData</from>
      <to>06_DerivarData</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>06_DerivarData</from>
      <to>07_ClassificarData</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>07_ClassificarData</from>
      <to>08_DeduplicarData</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>05_ValidarData</from>
      <to>Dummy (nulos e outlier) </to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>08_DeduplicarData</from>
      <to>09_FiltrarColunas</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>09_FiltrarColunas</from>
      <to>10_InsertUpdateBD</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <transform>
    <name>01_LerDadosRawBD</name>
    <type>TableInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>Postgres_COMEX</connection>
    <execute_each_row>N</execute_each_row>
    <limit>0</limit>
    <sql>SELECT DISTINCT
  data_coleta_raw,
  data_entrega_raw
FROM stg.historico_importacao_raw
WHERE COALESCE(data_coleta_raw, data_entrega_raw, prazo_contratado_raw) IS NOT NULL;</sql>
    <variables_active>N</variables_active>
    <attributes/>
    <GUI>
      <xloc>64</xloc>
      <yloc>112</yloc>
    </GUI>
  </transform>
  <transform>
    <name>02_UnpivotData</name>
    <type>Normaliser</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>data_coleta_raw</name>
        <norm>raw_date</norm>
        <value>coleta</value>
      </field>
      <field>
        <name>data_entrega_raw</name>
        <norm>raw_date</norm>
        <value>entrega</value>
      </field>
    </fields>
    <typefield>date_type</typefield>
    <attributes/>
    <GUI>
      <xloc>224</xloc>
      <yloc>112</yloc>
    </GUI>
  </transform>
  <transform>
    <name>03_AjustarFusoHorario</name>
    <type>ReplaceString</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <case_sensitive>N</case_sensitive>
        <in_stream_name>raw_date</in_stream_name>
        <is_unicode>Y</is_unicode>
        <out_stream_name>raw_date_fmt</out_stream_name>
        <replace_by_string> -03:00</replace_by_string>
        <replace_string>-03$</replace_string>
        <set_empty_string>N</set_empty_string>
        <use_regex>Y</use_regex>
        <whole_word>N</whole_word>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>400</xloc>
      <yloc>112</yloc>
    </GUI>
  </transform>
  <transform>
    <name>04_FormatarData</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <meta>
        <date_format_lenient>N</date_format_lenient>
        <length>7</length>
        <lenient_string_to_number>N</lenient_string_to_number>
        <name>date_type</name>
        <precision>-2</precision>
        <rename>date_type</rename>
        <roundingType>half_even</roundingType>
        <storage_type/>
        <type>String</type>
      </meta>
      <meta>
        <date_format_lenient>N</date_format_lenient>
        <length>2147483647</length>
        <lenient_string_to_number>N</lenient_string_to_number>
        <name>raw_date</name>
        <precision>-2</precision>
        <rename>raw_date</rename>
        <roundingType>half_even</roundingType>
        <storage_type/>
        <type>String</type>
      </meta>
      <meta>
        <conversion_mask>yyyy-MM-dd HH:mm:ss XXX</conversion_mask>
        <date_format_lenient>N</date_format_lenient>
        <length>-2</length>
        <lenient_string_to_number>N</lenient_string_to_number>
        <name>raw_date_fmt</name>
        <precision>-2</precision>
        <rename>dt</rename>
        <roundingType>half_even</roundingType>
        <storage_type/>
        <type>Date</type>
      </meta>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <GUI>
      <xloc>576</xloc>
      <yloc>112</yloc>
    </GUI>
  </transform>
  <transform>
    <name>05_ValidarData</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compare>
      <condition>
        <conditions>
          <condition>
            <conditions>
</conditions>
            <function>IS NOT NULL</function>
            <leftvalue>dt</leftvalue>
            <negated>N</negated>
            <operator>-</operator>
          </condition>
          <condition>
            <conditions>
              <condition>
                <conditions>
</conditions>
                <function>&gt;=</function>
                <leftvalue>dt</leftvalue>
                <negated>N</negated>
                <operator>AND</operator>
                <value>
                  <isnull>N</isnull>
                  <length>-1</length>
                  <mask>yyyy-MM-dd HH:mm:ss XXX</mask>
                  <name>constant</name>
                  <precision>-1</precision>
                  <text>1900-01-01 00:26:00 -02:34</text>
                  <type>Date</type>
                </value>
              </condition>
              <condition>
                <conditions>
</conditions>
                <function>&lt;=</function>
                <leftvalue>dt</leftvalue>
                <negated>N</negated>
                <operator>AND</operator>
                <value>
                  <isnull>N</isnull>
                  <length>-1</length>
                  <mask>yyyy-MM-dd HH:mm:ss XXX</mask>
                  <name>constant</name>
                  <precision>-1</precision>
                  <text>2030-01-01 00:00:00 -03:00</text>
                  <type>Date</type>
                </value>
              </condition>
            </conditions>
            <function>&gt;=</function>
            <leftvalue>dt</leftvalue>
            <negated>N</negated>
            <operator>AND</operator>
            <value>
              <isnull>N</isnull>
              <length>-1</length>
              <mask>yyyy-MM-dd HH:mm:ss XXX</mask>
              <name>constant</name>
              <precision>-1</precision>
              <text>1900-01-01 00:26:00 -02:34</text>
              <type>Date</type>
            </value>
          </condition>
        </conditions>
        <function>IS NOT NULL</function>
        <leftvalue>dt</leftvalue>
        <negated>N</negated>
        <operator>-</operator>
      </condition>
    </compare>
    <send_false_to>Dummy (nulos e outlier) </send_false_to>
    <send_true_to>06_DerivarData</send_true_to>
    <attributes/>
    <GUI>
      <xloc>736</xloc>
      <yloc>160</yloc>
    </GUI>
  </transform>
  <transform>
    <name>06_DerivarData</name>
    <type>Formula</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <formulas>
      <formula>
        <field_name>year</field_name>
        <formula>YEAR([dt] )</formula>
        <set_na>N</set_na>
        <value_length>-1</value_length>
        <value_precision>-1</value_precision>
        <value_type>5</value_type>
      </formula>
      <formula>
        <field_name>month</field_name>
        <formula>MONTH( [dt] )</formula>
        <set_na>N</set_na>
        <value_length>-1</value_length>
        <value_precision>-1</value_precision>
        <value_type>5</value_type>
      </formula>
      <formula>
        <field_name>day</field_name>
        <formula>DAY( [dt] )</formula>
        <set_na>N</set_na>
        <value_length>-1</value_length>
        <value_precision>-1</value_precision>
        <value_type>5</value_type>
      </formula>
      <formula>
        <field_name>week</field_name>
        <formula>WEEKNUM([dt])</formula>
        <set_na>N</set_na>
        <value_length>-1</value_length>
        <value_precision>-1</value_precision>
        <value_type>5</value_type>
      </formula>
      <formula>
        <field_name>weekday</field_name>
        <formula>WEEKDAY( [dt] )</formula>
        <set_na>N</set_na>
        <value_length>-1</value_length>
        <value_precision>-1</value_precision>
        <value_type>5</value_type>
      </formula>
    </formulas>
    <attributes/>
    <GUI>
      <xloc>576</xloc>
      <yloc>224</yloc>
    </GUI>
  </transform>
  <transform>
    <name>07_ClassificarData</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <compress>N</compress>
    <directory>${java.io.tmpdir}</directory>
    <fields>
      <field>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <name>dt</name>
        <presorted>N</presorted>
      </field>
    </fields>
    <sort_prefix>out</sort_prefix>
    <sort_size>1000000</sort_size>
    <unique_rows>N</unique_rows>
    <attributes/>
    <GUI>
      <xloc>400</xloc>
      <yloc>224</yloc>
    </GUI>
  </transform>
  <transform>
    <name>08_DeduplicarData</name>
    <type>Unique</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <count_rows>N</count_rows>
    <fields>
      <field>
        <case_insensitive>N</case_insensitive>
        <name>dt</name>
      </field>
    </fields>
    <reject_duplicate_row>N</reject_duplicate_row>
    <attributes/>
    <GUI>
      <xloc>224</xloc>
      <yloc>224</yloc>
    </GUI>
  </transform>
  <transform>
    <name>09_FiltrarColunas</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <remove>
        <name>date_type</name>
      </remove>
      <remove>
        <name>raw_date</name>
      </remove>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <GUI>
      <xloc>64</xloc>
      <yloc>272</yloc>
    </GUI>
  </transform>
  <transform>
    <name>10_InsertUpdateBD</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <commit>100</commit>
    <connection>Postgres_COMEX</connection>
    <lookup>
      <key>
        <condition>=</condition>
        <field>dt</field>
        <name>dt</name>
      </key>
      <schema>dw_dim</schema>
      <table>dim_date</table>
      <value>
        <name>dt</name>
        <rename>dt</rename>
        <update>N</update>
      </value>
      <value>
        <name>year</name>
        <rename>year</rename>
        <update>N</update>
      </value>
      <value>
        <name>month</name>
        <rename>month</rename>
        <update>N</update>
      </value>
      <value>
        <name>day</name>
        <rename>day</rename>
        <update>N</update>
      </value>
      <value>
        <name>week</name>
        <rename>week</rename>
        <update>N</update>
      </value>
      <value>
        <name>weekday</name>
        <rename>weekday</rename>
        <update>N</update>
      </value>
    </lookup>
    <update_bypassed>N</update_bypassed>
    <attributes/>
    <GUI>
      <xloc>224</xloc>
      <yloc>336</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Dummy (nulos e outlier) </name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <GUI>
      <xloc>736</xloc>
      <yloc>16</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Dummy (valores atípicos)</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <attributes/>
    <GUI>
      <xloc>400</xloc>
      <yloc>16</yloc>
    </GUI>
  </transform>
  <transform_error_handling>
    <error>
      <source_transform>03_AjustarFusoHorario</source_transform>
      <target_transform>Dummy (valores atípicos)</target_transform>
      <is_enabled>Y</is_enabled>
      <nr_valuename/>
      <descriptions_valuename/>
      <fields_valuename/>
      <codes_valuename/>
      <max_errors/>
      <max_pct_errors/>
      <min_pct_rows/>
    </error>
  </transform_error_handling>
  <attributes/>
</pipeline>
